# Kafka Dashboardä½¿ç”¨æŒ‡å—

## ðŸ“Š Dashboardæ¦‚è§ˆ

æˆ‘ä»¬ä¸ºä½ åˆ›å»ºäº†ä¸¤ä¸ªä¸“ä¸šçš„Kafkaç›‘æŽ§Dashboardï¼š

### 1. Kafkaé›†ç¾¤ç›‘æŽ§Dashboard (`kafka-cluster-dashboard.json`)
**ç”¨é€”**: é›†ç¾¤çº§åˆ«çš„æ•´ä½“ç›‘æŽ§å’Œå¥åº·çŠ¶æ€
**ç‰¹ç‚¹**: 
- é›†ç¾¤æ•´ä½“è§†å›¾
- è·¨Topicçš„èšåˆæŒ‡æ ‡
- Brokerå’ŒConsumerç»„ç»Ÿè®¡
- é›†ç¾¤æ€§èƒ½è¶‹åŠ¿

### 2. Kafka Topicè¯¦ç»†ç›‘æŽ§Dashboard (`kafka-topic-dashboard.json`)
**ç”¨é€”**: å•ä¸ªTopicçš„æ·±åº¦åˆ†æžå’Œç›‘æŽ§
**ç‰¹ç‚¹**:
- Topicé€‰æ‹©å™¨ (æ”¯æŒåŠ¨æ€åˆ‡æ¢)
- åˆ†åŒºçº§åˆ«çš„è¯¦ç»†ç›‘æŽ§
- Consumeræ¶ˆè´¹æƒ…å†µåˆ†æž
- å®žæ—¶æ€§èƒ½æŒ‡æ ‡

## ðŸš€ å¯¼å…¥æ­¥éª¤

### æ­¥éª¤1: è®¿é—®Grafana
```
http://localhost:3000
ç”¨æˆ·å: admin
å¯†ç : admin
```

### æ­¥éª¤2: é…ç½®æ•°æ®æº (å¦‚æžœè¿˜æœªé…ç½®)
1. ç‚¹å‡»å·¦ä¾§èœå• `Configuration` â†’ `Data Sources`
2. ç‚¹å‡» `Add data source`
3. é€‰æ‹© `Prometheus`
4. é…ç½®:
   - **Name**: `Prometheus`
   - **URL**: `http://prometheus:9090`
5. ç‚¹å‡» `Save & Test`

### æ­¥éª¤3: å¯¼å…¥Dashboard
1. ç‚¹å‡»å·¦ä¾§èœå• `+` â†’ `Import`
2. é€‰æ‹© `Upload JSON file`
3. åˆ†åˆ«ä¸Šä¼ ä¸¤ä¸ªDashboardæ–‡ä»¶
4. ç¡®è®¤é…ç½®å¹¶ç‚¹å‡» `Import`

## ðŸ“ˆ é›†ç¾¤ç›‘æŽ§Dashboardè¯¦è§£

### ç¬¬ä¸€è¡Œ: å…³é”®æŒ‡æ ‡ç»Ÿè®¡ (6ä¸ªStaté¢æ¿)
| é¢æ¿ | æŒ‡æ ‡ | è¯´æ˜Ž | å‘Šè­¦é˜ˆå€¼ |
|------|------|------|----------|
| **Brokeræ€»æ•°** | `kafka_brokers` | é›†ç¾¤ä¸­çš„Brokeræ•°é‡ | - |
| **Topicæ€»æ•°** | `count(kafka_topic_partitions)` | ä¸šåŠ¡Topicæ•°é‡ | - |
| **Consumerç»„æ€»æ•°** | `count(consumer_group)` | æ´»è·ƒConsumerç»„æ•° | >20 |
| **åˆ†åŒºæ€»æ•°** | `sum(kafka_topic_partitions)` | æ‰€æœ‰åˆ†åŒºæ€»æ•° | - |
| **æ€»æ¶ˆæ¯æ•°** | `sum(kafka_topic_partition_current_offset)` | é›†ç¾¤æ¶ˆæ¯æ€»é‡ | - |
| **æ€»ç§¯åŽ‹æ¶ˆæ¯æ•°** | `sum(kafka_consumer_lag_messages)` | æ‰€æœ‰ç§¯åŽ‹æ¶ˆæ¯ | >1000 |

### ç¬¬äºŒè¡Œ: æ€§èƒ½è¶‹åŠ¿ (2ä¸ªæ—¶é—´åºåˆ—)
- **é›†ç¾¤æ¶ˆæ¯ç”Ÿäº§é€ŸçŽ‡**: æ•´ä¸ªé›†ç¾¤çš„æ¶ˆæ¯ç”Ÿäº§QPS
- **Consumerç»„ç§¯åŽ‹è¶‹åŠ¿**: å„Consumerç»„çš„ç§¯åŽ‹å˜åŒ–

### ç¬¬ä¸‰è¡Œ: è¯¦ç»†ç»Ÿè®¡è¡¨ (2ä¸ªè¡¨æ ¼)
- **Topicç»Ÿè®¡è¡¨**: å„Topicçš„æ¶ˆæ¯æ•°ã€åˆ†åŒºæ•°ã€ç”Ÿäº§é€ŸçŽ‡
- **Consumerç»„ç§¯åŽ‹ç»Ÿè®¡**: å„Consumerç»„çš„ç§¯åŽ‹æƒ…å†µ

### ç¬¬å››è¡Œ: æ•´ä½“è¶‹åŠ¿ (1ä¸ªæ—¶é—´åºåˆ—)
- **å„Topicæ¶ˆæ¯æ•°é‡è¶‹åŠ¿**: æ‰€æœ‰Topicçš„æ¶ˆæ¯å¢žé•¿è¶‹åŠ¿

## ðŸŽ¯ Topicç›‘æŽ§Dashboardè¯¦è§£

### Topicé€‰æ‹©å™¨
- **ä½ç½®**: Dashboardé¡¶éƒ¨
- **åŠŸèƒ½**: åŠ¨æ€é€‰æ‹©è¦ç›‘æŽ§çš„Topic
- **é€‰é¡¹**: 
  - `All`: æ˜¾ç¤ºæ‰€æœ‰Topicçš„èšåˆæ•°æ®
  - å…·ä½“Topicåç§°: æ˜¾ç¤ºå•ä¸ªTopicçš„è¯¦ç»†æ•°æ®

### ç¬¬ä¸€è¡Œ: TopicåŸºç¡€ç»Ÿè®¡ (4ä¸ªStaté¢æ¿)
| é¢æ¿ | æŸ¥è¯¢ | è¯´æ˜Ž |
|------|------|------|
| **åˆ†åŒºæ•°** | `kafka_topic_partitions{topic=~"$topic"}` | é€‰ä¸­Topicçš„åˆ†åŒºæ•°é‡ |
| **æ¶ˆæ¯æ€»æ•°** | `sum(kafka_topic_partition_current_offset{topic=~"$topic"})` | é€‰ä¸­Topicçš„æ¶ˆæ¯æ€»æ•° |
| **ç”Ÿäº§é€ŸçŽ‡** | `sum(rate(kafka_topic_partition_current_offset{topic=~"$topic"}[5m]))` | é€‰ä¸­Topicçš„ç”Ÿäº§é€ŸçŽ‡ |
| **ç§¯åŽ‹æ¶ˆæ¯æ•°** | `sum(kafka_consumer_lag_messages{topic=~"$topic"})` | é€‰ä¸­Topicçš„ç§¯åŽ‹æ€»æ•° |

### ç¬¬äºŒè¡Œ: åˆ†åŒºçº§ç›‘æŽ§ (2ä¸ªæ—¶é—´åºåˆ—)
- **å„åˆ†åŒºæ¶ˆæ¯æ•°é‡è¶‹åŠ¿**: æ¯ä¸ªåˆ†åŒºçš„æ¶ˆæ¯å¢žé•¿æƒ…å†µ
- **å„åˆ†åŒºç”Ÿäº§é€ŸçŽ‡è¶‹åŠ¿**: æ¯ä¸ªåˆ†åŒºçš„ç”Ÿäº§é€ŸçŽ‡å˜åŒ–

### ç¬¬ä¸‰è¡Œ: åˆ†åŒºè¯¦ç»†ä¿¡æ¯ (1ä¸ªè¡¨æ ¼)
- **åˆ†åŒºè¯¦ç»†ä¿¡æ¯**: åŒ…å«æ¯ä¸ªåˆ†åŒºçš„æ¶ˆæ¯æ•°å’Œç”Ÿäº§é€ŸçŽ‡

### ç¬¬å››è¡Œ: Consumerç›‘æŽ§ (2ä¸ªæ—¶é—´åºåˆ—)
- **Consumerç§¯åŽ‹è¶‹åŠ¿**: å„Consumerç»„åœ¨è¯¥Topicä¸Šçš„ç§¯åŽ‹æƒ…å†µ
- **Consumeræ¶ˆè´¹è¿›åº¦**: å„Consumerç»„çš„æ¶ˆè´¹è¿›åº¦ç™¾åˆ†æ¯”

### ç¬¬äº”è¡Œ: Consumerè¯¦ç»†ä¿¡æ¯ (1ä¸ªè¡¨æ ¼)
- **Consumerè¯¦ç»†ä¿¡æ¯**: åŒ…å«ç§¯åŽ‹æ•°ã€å½“å‰åç§»é‡ã€æ¶ˆè´¹è¿›åº¦

## ðŸ” ä½¿ç”¨åœºæ™¯

### é›†ç¾¤ç›‘æŽ§Dashboardé€‚ç”¨äºŽ:
- **è¿ç»´äººå‘˜**: ç›‘æŽ§æ•´ä¸ªKafkaé›†ç¾¤çš„å¥åº·çŠ¶æ€
- **æž¶æž„å¸ˆ**: åˆ†æžé›†ç¾¤å®¹é‡å’Œæ€§èƒ½è§„åˆ’
- **ç®¡ç†è€…**: äº†è§£ç³»ç»Ÿæ•´ä½“è¿è¡Œæƒ…å†µ
- **å‘Šè­¦é…ç½®**: è®¾ç½®é›†ç¾¤çº§åˆ«çš„å‘Šè­¦è§„åˆ™

### Topicç›‘æŽ§Dashboardé€‚ç”¨äºŽ:
- **å¼€å‘äººå‘˜**: ç›‘æŽ§ç‰¹å®šä¸šåŠ¡Topicçš„æ€§èƒ½
- **ä¸šåŠ¡åˆ†æž**: åˆ†æžç‰¹å®šä¸šåŠ¡çº¿çš„æ¶ˆæ¯æµé‡
- **é—®é¢˜æŽ’æŸ¥**: æ·±å…¥åˆ†æžå•ä¸ªTopicçš„é—®é¢˜
- **æ€§èƒ½ä¼˜åŒ–**: ä¼˜åŒ–ç‰¹å®šTopicçš„åˆ†åŒºå’Œæ¶ˆè´¹ç­–ç•¥

## ðŸ“Š å…³é”®æŸ¥è¯¢è¯­å¥

### é›†ç¾¤çº§æŸ¥è¯¢
```promql
# é›†ç¾¤æ€»ç”Ÿäº§é€ŸçŽ‡
sum(rate(kafka_topic_partition_current_offset{topic!~"__.*"}[5m]))

# é›†ç¾¤æ€»ç§¯åŽ‹
sum(kafka_consumer_lag_messages)

# Topicæ•°é‡
count by () (group by (topic) (kafka_topic_partitions{topic!~"__.*"}))

# Consumerç»„æ•°é‡
count by () (group by (consumer_group) (kafka_consumer_lag_messages))
```

### Topicçº§æŸ¥è¯¢
```promql
# ç‰¹å®šTopicçš„åˆ†åŒºæ•°
kafka_topic_partitions{topic="your-topic"}

# ç‰¹å®šTopicçš„æ¶ˆæ¯æ€»æ•°
sum(kafka_topic_partition_current_offset{topic="your-topic"})

# ç‰¹å®šTopicçš„ç”Ÿäº§é€ŸçŽ‡
sum(rate(kafka_topic_partition_current_offset{topic="your-topic"}[5m]))

# ç‰¹å®šTopicçš„Consumerç§¯åŽ‹
sum(kafka_consumer_lag_messages{topic="your-topic"})

# Consumeræ¶ˆè´¹è¿›åº¦
(kafka_consumer_current_offset{topic="your-topic"} / kafka_consumer_log_end_offset{topic="your-topic"}) * 100
```

## ðŸš¨ å‘Šè­¦å»ºè®®

### é›†ç¾¤çº§å‘Šè­¦
```promql
# æ€»ç§¯åŽ‹è¿‡å¤š
sum(kafka_consumer_lag_messages) > 1000

# Consumerç»„è¿‡å¤š
count by () (group by (consumer_group) (kafka_consumer_lag_messages)) > 20

# é›†ç¾¤ç”Ÿäº§é€ŸçŽ‡å¼‚å¸¸
sum(rate(kafka_topic_partition_current_offset{topic!~"__.*"}[5m])) > 10000
```

### Topicçº§å‘Šè­¦
```promql
# ç‰¹å®šTopicç§¯åŽ‹è¿‡å¤š
sum(kafka_consumer_lag_messages{topic="important-topic"}) > 100

# ç‰¹å®šTopicç”Ÿäº§é€ŸçŽ‡å¼‚å¸¸
sum(rate(kafka_topic_partition_current_offset{topic="important-topic"}[5m])) > 1000

# Consumeræ¶ˆè´¹è¿›åº¦è¿‡ä½Ž
(kafka_consumer_current_offset{topic="important-topic"} / kafka_consumer_log_end_offset{topic="important-topic"}) * 100 < 50
```

## ðŸŽ¨ è‡ªå®šä¹‰å»ºè®®

### æ·»åŠ æ›´å¤šå˜é‡
å¯ä»¥åœ¨Topic Dashboardä¸­æ·»åŠ æ›´å¤šå˜é‡ï¼š
- **Consumerç»„é€‰æ‹©å™¨**: è¿‡æ»¤ç‰¹å®šConsumerç»„
- **åˆ†åŒºé€‰æ‹©å™¨**: ç›‘æŽ§ç‰¹å®šåˆ†åŒº
- **æ—¶é—´èŒƒå›´é€‰æ‹©å™¨**: å¿«é€Ÿåˆ‡æ¢æ—¶é—´èŒƒå›´

### é¢æ¿è‡ªå®šä¹‰
- **è°ƒæ•´åˆ·æ–°é¢‘çŽ‡**: æ ¹æ®éœ€è¦è°ƒæ•´è‡ªåŠ¨åˆ·æ–°é—´éš”
- **ä¿®æ”¹é¢œè‰²é˜ˆå€¼**: æ ¹æ®ä¸šåŠ¡éœ€æ±‚è°ƒæ•´å‘Šè­¦é¢œè‰²
- **æ·»åŠ æ³¨é‡Š**: åœ¨é‡è¦æ—¶é—´ç‚¹æ·»åŠ äº‹ä»¶æ³¨é‡Š
- **åˆ›å»ºå¿«ç…§**: ä¿å­˜é‡è¦æ—¶åˆ»çš„ç›‘æŽ§å¿«ç…§

## ðŸ“ æœ€ä½³å®žè·µ

1. **åˆ†å±‚ç›‘æŽ§**: å…ˆçœ‹é›†ç¾¤Dashboardäº†è§£æ•´ä½“ï¼Œå†ç”¨Topic Dashboardæ·±å…¥åˆ†æž
2. **å®šæœŸæ£€æŸ¥**: å»ºè®®æ¯å¤©æ£€æŸ¥é›†ç¾¤Dashboardï¼Œå‘çŽ°å¼‚å¸¸æ—¶ä½¿ç”¨Topic Dashboard
3. **å‘Šè­¦é…ç½®**: ä¸ºå…³é”®æŒ‡æ ‡é…ç½®å‘Šè­¦ï¼ŒåŠæ—¶å‘çŽ°é—®é¢˜
4. **æ€§èƒ½åŸºçº¿**: è®°å½•æ­£å¸¸æƒ…å†µä¸‹çš„æŒ‡æ ‡åŸºçº¿ï¼Œä¾¿äºŽå¼‚å¸¸æ£€æµ‹
5. **æ–‡æ¡£è®°å½•**: è®°å½•é‡è¦çš„é…ç½®å˜æ›´å’Œæ€§èƒ½äº‹ä»¶

## ðŸ”§ æ•…éšœæŽ’æŸ¥æµç¨‹

### å‘çŽ°é—®é¢˜
1. åœ¨é›†ç¾¤Dashboardä¸­å‘çŽ°å¼‚å¸¸æŒ‡æ ‡
2. ç¡®å®šæ˜¯å“ªä¸ªTopicæˆ–Consumerç»„çš„é—®é¢˜

### æ·±å…¥åˆ†æž
1. ä½¿ç”¨Topic Dashboardé€‰æ‹©é—®é¢˜Topic
2. æŸ¥çœ‹åˆ†åŒºçº§åˆ«çš„è¯¦ç»†æ•°æ®
3. åˆ†æžConsumerçš„æ¶ˆè´¹æƒ…å†µ

### è§£å†³é—®é¢˜
1. æ ¹æ®ç›‘æŽ§æ•°æ®å®šä½æ ¹æœ¬åŽŸå› 
2. é‡‡å–ç›¸åº”çš„ä¼˜åŒ–æŽªæ–½
3. æŒç»­ç›‘æŽ§éªŒè¯æ•ˆæžœ

---

çŽ°åœ¨ä½ æ‹¥æœ‰äº†ä¸¤ä¸ªåŠŸèƒ½å®Œæ•´çš„Kafkaç›‘æŽ§Dashboardï¼ðŸŽ‰
