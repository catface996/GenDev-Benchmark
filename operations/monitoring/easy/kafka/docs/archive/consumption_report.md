# ğŸ“Š Consumer-Group-2 æ¶ˆè´¹æ¨¡æ‹ŸæŠ¥å‘Š

## ğŸ¯ æ¶ˆè´¹æ“ä½œæ¦‚è§ˆ
- **æ¶ˆè´¹è€…ç»„**: consumer-group-2
- **ç›®æ ‡Topic**: topic-1
- **æ¶ˆè´¹æ•°é‡**: 10æ¡æ¶ˆæ¯
- **æ“ä½œæ—¶é—´**: $(date '+%Y-%m-%d %H:%M:%S')

## ğŸ“ˆ æ¶ˆè´¹å‰åå¯¹æ¯”

### æ¶ˆè´¹å‰çŠ¶æ€
| åˆ†åŒº | Current Offset | Log End Offset | ç§¯å‹æ¶ˆæ¯æ•° |
|------|----------------|----------------|------------|
| 0    | 0              | 32             | 32         |
| 1    | 0              | 30             | 30         |
| 2    | 0              | 38             | 38         |
| **æ€»è®¡** | **0**      | **100**        | **100**    |

### æ¶ˆè´¹åçŠ¶æ€
| åˆ†åŒº | Current Offset | Log End Offset | ç§¯å‹æ¶ˆæ¯æ•° | æ¶ˆè´¹æ•°é‡ |
|------|----------------|----------------|------------|----------|
| 0    | 4              | 32             | 28         | 4        |
| 1    | 3              | 30             | 27         | 3        |
| 2    | 3              | 38             | 35         | 3        |
| **æ€»è®¡** | **10**     | **100**        | **90**     | **10**   |

## ğŸ“Š å…³é”®æŒ‡æ ‡å˜åŒ–

### ç§¯å‹æƒ…å†µ
- **æ¶ˆè´¹å‰æ€»ç§¯å‹**: 100æ¡æ¶ˆæ¯
- **æ¶ˆè´¹åæ€»ç§¯å‹**: 90æ¡æ¶ˆæ¯
- **ç§¯å‹å‡å°‘é‡**: 10æ¡æ¶ˆæ¯ âœ…
- **ç§¯å‹å‡å°‘ç‡**: 10%

### æ¶ˆè´¹è¿›åº¦
- **æ¶ˆè´¹å‰è¿›åº¦**: 0% (0/100)
- **æ¶ˆè´¹åè¿›åº¦**: 10% (10/100)
- **è¿›åº¦æå‡**: +10%

### åˆ†åŒºæ¶ˆè´¹åˆ†å¸ƒ
- **åˆ†åŒº0**: æ¶ˆè´¹4æ¡ (40%)
- **åˆ†åŒº1**: æ¶ˆè´¹3æ¡ (30%)
- **åˆ†åŒº2**: æ¶ˆè´¹3æ¡ (30%)

## ğŸ” PrometheusæŸ¥è¯¢éªŒè¯

### æŸ¥çœ‹æ¶ˆè´¹åçš„ç§¯å‹æƒ…å†µ
```promql
kafka_consumer_lag_messages{topic="topic-1", consumer_group="consumer-group-2"}
```

### æŸ¥çœ‹å½“å‰offset
```promql
kafka_consumer_current_offset{topic="topic-1", consumer_group="consumer-group-2"}
```

### è®¡ç®—æ¶ˆè´¹è¿›åº¦
```promql
(kafka_consumer_current_offset{topic="topic-1", consumer_group="consumer-group-2"} / kafka_consumer_log_end_offset{topic="topic-1", consumer_group="consumer-group-2"}) * 100
```

## ğŸ“‹ æ‰€æœ‰æ¶ˆè´¹è€…ç»„å¯¹æ¯”

| æ¶ˆè´¹è€…ç»„ | æ¶ˆè´¹å‰ç§¯å‹ | æ¶ˆè´¹åç§¯å‹ | å˜åŒ– | çŠ¶æ€ |
|----------|------------|------------|------|------|
| consumer-group-1 | 0 | 0 | æ— å˜åŒ– | ğŸŸ¢ æ­£å¸¸ |
| consumer-group-2 | 100 | 90 | -10æ¡ | ğŸŸ¡ æ”¹å–„ä¸­ |
| consumer-group-3 | 70 | 70 | æ— å˜åŒ– | ğŸ”´ å¾…å¤„ç† |

## ğŸš¨ å‘Šè­¦çŠ¶æ€å˜åŒ–

### æ¶ˆè´¹å‰å‘Šè­¦
- ğŸ”´ **ä¸¥é‡ç§¯å‹**: consumer-group-2 (100æ¡)
- âš ï¸ **ä¸­ç­‰ç§¯å‹**: consumer-group-3 (70æ¡)

### æ¶ˆè´¹åå‘Šè­¦
- ğŸŸ  **ä¸­ç­‰ç§¯å‹**: consumer-group-2 (90æ¡) â¬‡ï¸ ä»ä¸¥é‡é™çº§
- âš ï¸ **ä¸­ç­‰ç§¯å‹**: consumer-group-3 (70æ¡) æ— å˜åŒ–

## ğŸ’¡ åˆ†æä¸å»ºè®®

### æ¶ˆè´¹æ•ˆæœ
âœ… **æˆåŠŸæ¶ˆè´¹**: æŒ‰è®¡åˆ’æ¶ˆè´¹äº†10æ¡æ¶ˆæ¯
âœ… **ç§¯å‹å‡å°‘**: æ€»ç§¯å‹ä»100æ¡é™è‡³90æ¡
âœ… **å‘Šè­¦é™çº§**: ä»ä¸¥é‡ç§¯å‹é™çº§ä¸ºä¸­ç­‰ç§¯å‹

### åˆ†åŒºå‡è¡¡æ€§
- åˆ†åŒº0æ¶ˆè´¹æœ€å¤š(4æ¡)ï¼Œå¯èƒ½å› ä¸ºæ¶ˆæ¯åˆ†å¸ƒä¸å‡
- åˆ†åŒº1å’Œ2å„æ¶ˆè´¹3æ¡ï¼Œç›¸å¯¹å‡è¡¡
- å»ºè®®ç›‘æ§åˆ†åŒºé—´çš„æ¶ˆè´¹å‡è¡¡æ€§

### åç»­å»ºè®®
1. **ç»§ç»­æ¶ˆè´¹**: consumer-group-2è¿˜æœ‰90æ¡ç§¯å‹éœ€è¦å¤„ç†
2. **ç›‘æ§consumer-group-3**: 70æ¡ç§¯å‹æœªå¤„ç†
3. **ä¼˜åŒ–æ¶ˆè´¹é€Ÿç‡**: å¯è€ƒè™‘å¢åŠ æ¶ˆè´¹è€…å®ä¾‹
4. **è®¾ç½®è‡ªåŠ¨åŒ–**: åŸºäºç§¯å‹é˜ˆå€¼è‡ªåŠ¨æ‰©ç¼©å®¹

## ğŸ”„ å®æ—¶ç›‘æ§å‘½ä»¤

```bash
# æŸ¥çœ‹å½“å‰ç§¯å‹æƒ…å†µ
curl -s "http://localhost:9090/api/v1/query?query=sum%20by%20(consumer_group)%20(kafka_consumer_lag_messages%7Btopic%3D%22topic-1%22%7D)"

# æŸ¥çœ‹æ¶ˆè´¹è¿›åº¦
curl -s "http://localhost:9090/api/v1/query?query=(kafka_consumer_current_offset%7Btopic%3D%22topic-1%22%7D%20/%20kafka_consumer_log_end_offset%7Btopic%3D%22topic-1%22%7D)%20*%20100"

# å¯åŠ¨å®æ—¶ç›‘æ§
./realtime_lag_monitor.sh
```
